"use strict";window.printCalcLibrary=(function(){return{helpIcon:function(b){var a=$("<a>",{"class":"material-icons material-icons_touchable align-top ml-1 text-secondary",target:"_blank",tabindex:"-1","data-toggle":"tooltip","data-placement":"top",title:b.title,}).tooltip().html("&#xE8FD;");if(b.url){a.attr("href",b.url)}if(b.insertIn){a.appendTo(b.insertIn)}return a},badge:function(b){var a=$("<span>",{"class":"badge badge-pill badge-success ml-2"}).text(b.badgeTitle);if(b.toolTipTitle){a.attr({"data-toggle":"tooltip","data-placement":"top",title:b.toolTipTitle}).tooltip()}if(b.insertIn){a.appendTo(b.insertIn)}return a},sizeBlok:function(c){var i=$("<div>",{"class":"form-row"});var d=$("<div>",{"class":"form-group col"}).appendTo(i);var b=$("<input>",{type:"number","class":"form-control form-control-sm",id:c.inputName+"-width",name:c.inputName+"-width",placeholder:"ширина метров"}).appendTo(d);if(c.isPrintSize){$("<div>",{"class":"invalid-feedback"}).text("от 0.1 до 500").appendTo(d)}var e=$("<i>",{"class":"material-icons material-icons_touchable mt-1 text-secondary"}).html("&#xE8D4;").appendTo(i);var j=$("<div>",{"class":"form-group col"}).appendTo(i);var k=$("<input>",{type:"number","class":"form-control form-control-sm",id:c.inputName+"-height",name:c.inputName+"-height",placeholder:"высота метров"}).appendTo(j);if(c.isPrintSize){$("<div>",{"class":"invalid-feedback"}).text("от 0.1 до 500").appendTo(j)}var a=$("<div>",{"class":"form-group col"}).appendTo(i);var f=$("<input>",{type:"number","class":"form-control form-control-sm",id:c.inputName+"-quantity",name:c.inputName+"-quantity",placeholder:"кол-во штук"}).appendTo(a);if(c.isPrintSize){$("<div>",{"class":"invalid-feedback"}).text("от 1 до 5000").appendTo(a)}var h=$("<div>",{"class":"form-group col"}).appendTo(i);var g=$("<input>",{type:"text","class":"form-control form-control-sm",id:c.inputName+"-filename",name:c.inputName+"-filename",placeholder:"имя файла"}).appendTo(h);var l=$("<i>",{"class":"material-icons material-icons_touchable mt-1 text-secondary"}).html("&#xE14C;").appendTo(i);if(c.isertBefore){c.isertBefore.before(i)}return{blok:i,width:b,height:k,quantityWrapper:a,quantity:f,fileNameWrapper:h,fileName:g,swap:e,close:l}},typeBlok:function(d){var b=false;var c=$("<div>",{"class":"form-group col-sm-4"});$("<label>",{"for":d.selectName}).text(d.title).appendTo(c);if(d.helpIconTitle){b=this.helpIcon({title:d.helpIconTitle,insertIn:c})}var a=$("<select>",{"class":"custom-select custom-select-sm",id:d.selectName,name:d.selectName}).appendTo(c);if(d.insertIn){c.appendTo(d.insertIn)}return{blok:c,select:a,helpIcon:b}},chekboxBlok:function(e){var a=false;var c=$("<div>",{"class":"custom-control custom-checkbox mb-3"});var d=$("<input>",{type:"checkbox","class":"custom-control-input",id:e.checkboxName,name:e.checkboxName}).appendTo(c);var b=$("<label>",{"class":"custom-control-label","for":e.checkboxName}).text(e.title).appendTo(c);if(e.helpIconTitle){a=this.helpIcon({title:e.helpIconTitle,insertIn:c})}if(e.helpIconTitle&&e.helpIconUrl){a.attr("href",e.helpIconUrl)}if(e.insertIn){c.appendTo(e.insertIn)}return{blok:c,checkbox:d,helpIcon:a}},selectInputBlok:function(b){var e=false;var i=false;var h=false;var j=false;var a="";if(b.inputTitle){a=b.inputTitle}var f=$("<div>",{"class":"form-row"});if(!b.inputType){b.inputType="number"}if(b.selectName){var d=$("<div>",{"class":"form-group col-3 col-md-4"}).appendTo(f);i=$("<select>",{"class":"custom-select custom-select-sm",id:b.selectName,name:b.selectName}).appendTo(d)}if(b.inputName){var j=$("<div>",{"class":"form-group col-3 col-md-4"}).appendTo(f);h=$("<input>",{type:b.inputType,"class":"form-control form-control-sm",id:b.inputName,name:b.inputName,placeholder:a}).appendTo(j)}if(b.title||b.helpIconTitle){var c=$("<div>",{"class":"col-6 col-md-4 align-bottom mt-1"}).appendTo(f)}if(b.title){var g=$("<label>",{"for":b.selectName}).text(b.title).appendTo(c)}if(b.helpIconTitle){e=this.helpIcon({title:b.helpIconTitle,insertIn:c})}if(b.helpIconTitle&&b.helpIconUrl){e.attr("href",b.helpIconUrl)}if(b.insertIn){f.appendTo(b.insertIn)}return{blok:f,select:i,input:h,inputWrapper:j,helpIcon:e}},tabs:function(g){var c=$(document.createDocumentFragment());var b=$("<ul>",{"class":"nav nav-tabs mb-3",id:g.blokName+"-tabs",role:"tablist"}).appendTo(c);var f=$("<div>",{"class":"tab-content",id:g.blokName+"-content"}).appendTo(c);for(var d=0;d<g.tabs.length;d++){var e=$("<li>",{"class":"nav-item"});var h=$("<a>",{"class":"nav-link","data-toggle":"tab",id:g.blokName+"-tab-"+d,href:"#"+g.blokName+"-content-"+d,role:"tab","aria-controls":g.blokName+"-content-"+d,"aria-selected":"false"}).text(g.tabs[d].tabTitle).appendTo(e);var a=g.tabs[d].tabContent.attr({"class":"tab-pane fade",id:g.blokName+"-content-"+d,role:"tabpanel","aria-labelledby":g.blokName+"-tab-"+d});if(g.tabs[d].isActive){h.attr("aria-selected","true");h.addClass("active");a.addClass("show active")}e.appendTo(b);a.appendTo(f)}if(g.insertIn){c.appendTo(g.insertIn)}return c},getFullArrItemsNumber:function(a){var b=0;for(var c=0;c<a.length;c++){if(a[c]){b++}}return b},getMaxValue:function(a,c){var d=0;for(var b=0;b<a.length;b++){if(a[b]>d&&a[b]<=c){d=a[b]}}return d},getFirstLastFillArrIndex:function(b,a){var d=false;for(var c=b;c>=0;c--){if(a[c-1]){d=c-1;break}}return d},getObjItemValue:function(c){var a={};for(var b in c){if(c[b]===false){a[b]=false}else{if(typeof(c[b])==="number"){a[b]=c[b]}else{if(c[b].jquery&&c[b].prop("nodeName")==="INPUT"&&c[b].prop("type")==="checkbox"){a[b]=c[b].prop("checked")}else{if(c[b].jquery&&c[b].prop("nodeName")==="INPUT"){if(c[b].prop("type")==="text"||c[b].prop("type")==="number"){a[b]=c[b].val()}}else{if(c[b].jquery&&c[b].prop("nodeName")==="SELECT"){a[b]=c[b].val()}else{a[b]="some data"}}}}}}return a},getPrintCalcFormValue:function(d){var b={orderItems:[],orderControl:{}};if(d.orderItems){var a=0;for(var h=0;d.orderItems.length>h;h++){if(d.orderItems[h]!==false){b.orderItems[a]=this.getObjItemValue(d.orderItems[h]);b.orderItems[a].printSize=[];var c=0;for(var g=0;d.orderItems[h].printSize.length>g;g++){if(d.orderItems[h].printSize[g]!==false){b.orderItems[a].printSize[c]=this.getObjItemValue(d.orderItems[h].printSize[g]);c++}}b.orderItems[a].canvasSize=[];var f=0;for(var e=0;d.orderItems[h].canvasSize.length>e;e++){if(d.orderItems[h].canvasSize[e]!==false){b.orderItems[a].canvasSize[f]=this.getObjItemValue(d.orderItems[h].canvasSize[e]);f++}}if(d.orderItems[h].simpleOptionalWork){b.orderItems[a].simpleOptionalWork=this.getObjItemValue(d.orderItems[h].simpleOptionalWork)}if(d.orderItems[h].customOptionalWork){b.orderItems[a].customOptionalWork={};if(d.orderItems[h].customOptionalWork.top){b.orderItems[a].customOptionalWork.top=this.getObjItemValue(d.orderItems[h].customOptionalWork.top)}if(d.orderItems[h].customOptionalWork.bottom){b.orderItems[a].customOptionalWork.bottom=this.getObjItemValue(d.orderItems[h].customOptionalWork.bottom)}if(d.orderItems[h].customOptionalWork.right){b.orderItems[a].customOptionalWork.right=this.getObjItemValue(d.orderItems[h].customOptionalWork.right)}if(d.orderItems[h].customOptionalWork.left){b.orderItems[a].customOptionalWork.left=this.getObjItemValue(d.orderItems[h].customOptionalWork.left)}}a++}}}if(d.orderControl){b.orderControl=this.getObjItemValue(d.orderControl)}return b},checkRequiredFieldsNotEmpty:function(d){var b=true;function e(g){for(var f=0;g.length>f;f++){if(g[f].width&&+g[f].width.val()<0.01||g[f].width&&+g[f].width.val()>500){g[f].width.addClass("is-invalid");b=false}else{if(g[f].width){g[f].width.removeClass("is-invalid")}}if(g[f].height&&+g[f].height.val()<0.01||g[f].height&&+g[f].height.val()>500){g[f].height.addClass("is-invalid");b=false}else{if(g[f].height){g[f].height.removeClass("is-invalid")}}if(g[f].quantity&&+g[f].quantity.val()<1||g[f].quantity&&+g[f].quantity.val()>5000){g[f].quantity.addClass("is-invalid");b=false}else{if(g[f].quantity){g[f].quantity.removeClass("is-invalid")}}}}function a(f){if(f.val()==null||f.val()==="none"){f.addClass("is-invalid");b=false}else{f.removeClass("is-invalid")}}for(var c=0;d.orderItems.length>c;c++){if(!d.orderItems[c].printType){continue}d.orderItems[c].alertsWrapper.fadeOut(100);e(d.orderItems[c].printSize);e(d.orderItems[c].canvasSize);a(d.orderItems[c].printType);a(d.orderItems[c].materialGroup);a(d.orderItems[c].materialType)}return b},checkAvalaibleCanvasWidth:function(d){var a=true;for(var c=0;d.orderItems.length>c;c++){if(d.orderItems[c].canvasWidthError){d.orderItems[c].canvasWidthError.remove();delete d.orderItems[c].canvasWidthError}if(!d.orderItems[c].canvasSize){continue}var e=true;for(var b=0;d.orderItems[c].canvasSize.length>b;b++){if(d.orderItems[c].canvasSize[b].width&&+d.orderItems[c].canvasSize[b].width.val()>d.orderItems[c].maxPrintWidth){e=false;a=false;d.orderItems[c].canvasSize[b].width.addClass("is-invalid")}else{if(d.orderItems[c].canvasSize[b].width){d.orderItems[c].canvasSize[b].width.removeClass("is-invalid")}}}if(!d.orderItems[c].canvasWidthError&&e===false){d.orderItems[c].canvasWidthError=$("<div>",{"class":"alert alert-danger",role:"alert"}).html("При компановке ширина холста не может быть больше чем, максимальная ширина печатного поля.<br>- максимальная ширина холста "+d.orderItems[c].maxPrintWidth+" м");d.orderItems[c].canvasWidthError.appendTo(d.orderItems[c].alertsWrapper);d.orderItems[c].alertsWrapper.fadeIn(100)}}return a},checkPrintSquareNotOverflow:function(f){var a=true;function e(h){var j=0;var k=0;for(var g=0;h.length>g;g++){if(h[g].width&&+h[g].width.val()>0&&h[g].height&&+h[g].height.val()>0&&h[g].quantity&&+h[g].quantity.val()>0){j=j+(+h[g].width.val()*+h[g].height.val()*+h[g].quantity.val());k++}}return{square:j,quantity:k}}for(var d=0;f.orderItems.length>d;d++){if(f.orderItems[d].squareOverflowError){f.orderItems[d].squareOverflowError.remove();delete f.orderItems[d].squareOverflowError}if(!f.orderItems[d].canvasSize){continue}var c=e(f.orderItems[d].canvasSize);if(c.quantity===0){continue}var b=e(f.orderItems[d].printSize);if(b.square>c.square){a=false;f.orderItems[d].squareOverflowError=$("<div>",{"class":"alert alert-danger",role:"alert"}).html("При компановке площадь отпечатка не может быть больше площади холста.<br>- площадь отпечатка "+(Math.ceil(b.square*100)/100)+" м<sup>2</sup><br>- площадь холста "+(Math.ceil(c.square*100)/100)+" м<sup>2</sup>");f.orderItems[d].squareOverflowError.appendTo(f.orderItems[d].alertsWrapper);f.orderItems[d].alertsWrapper.fadeIn(100)}}return a},checkForm:function(e){if(e.orderControl.checkFormError){e.orderControl.checkFormError.fadeOut(100).remove();delete e.orderControl.checkFormError}var a=false;var b=this.checkRequiredFieldsNotEmpty(e);var d=false;var c=false;if(b){d=this.checkAvalaibleCanvasWidth(e)}if(d){c=this.checkPrintSquareNotOverflow(e)}if(c){a=true}if(a===false){this.shsowOrderControlErrorMassage(e,"При заполнении допущены ошибки")}return a},checkCorrectCustomer:function(d,c){d.orderControl.customer.removeClass("is-invalid");if(d.orderControl.checkFormError){d.orderControl.checkFormError.fadeOut(100).remove();delete d.orderControl.checkFormError}var e=d.orderControl.customer.val();var a=false;for(var b=0;b<c.length;b++){if(c[b].name&&c[b].name===e){var a=true;break}}if(!a){d.orderControl.customer.addClass("is-invalid");this.shsowOrderControlErrorMassage(d,"Несохраненный клиент")}return a},shsowOrderControlErrorMassage:function(a,b){if(a.orderControl.checkFormError){a.orderControl.checkFormError.fadeOut(100).remove();delete a.orderControl.checkFormError}a.orderControl.checkFormError=$("<div>",{"class":"alert alert-danger",role:"alert"}).fadeOut(0).html(b);a.orderControl.checkFormError.appendTo(a.orderControl.alertsWrapper);a.orderControl.checkFormError.fadeIn(100)},createPriceDescriptionBlok:function(l,j,k,d){if(j.orderControl.priceDescription){j.orderControl.priceDescription.fadeOut(100).remove();delete j.orderControl.priceDescription}if(!l.commonData){return false}if(!l.commonData.calculations){return false}if(!l.commonData.calculations.total){return false}function b(n,r){if(!n.productParam){return false}if(!n.calculations){return false}if(!n.productParam.materialTypeRu){return false}if(!n.productParam.simpleOptionalWork){return false}var t={cringle:true,gain:true,cut:true,cord:true,pocket:true,coupling:true,lamination:true,stickToPlastic:true,designPrice:true,total:true};var m="";var u="";if(n.productParam.simpleOptionalWork.lamination&&n.productParam.simpleOptionalWork.lamination.length>1){m=", "+n.productParam.simpleOptionalWork.lamination}if(n.productParam.simpleOptionalWork.stickToPlastic&&n.productParam.simpleOptionalWork.stickToPlastic.length>1){u=", "+n.productParam.simpleOptionalWork.stickToPlastic}var q=$("<div>");$("<span>").text((+n.productParam.index+1)+". "+n.productParam.materialTypeRu+", "+n.productParam.printTypeRu+m+u).appendTo(q);for(var o=0;n.curentSizeParam.printSize.length>o;o++){if(!n.curentSizeParam.printSize[o].price){continue}$("<br>").appendTo(q);$("<span>").text("- размер: "+n.curentSizeParam.printSize[o].width/k.CONVERT_MM_TO_SIZE_UNIT+" * "+n.curentSizeParam.printSize[o].height/k.CONVERT_MM_TO_SIZE_UNIT+", "+n.curentSizeParam.printSize[o].quantity+" шт, "+n.curentSizeParam.printSize[o].price+" "+k.CURRENCY_ABR).appendTo(q)}var p=$("<ul>",{"class":"mb-3 mt-2"}).appendTo(q);$("<li>").html("печать: "+(n.calculations.print.totalPrice+n.calculations.overspending.totalPrice)+" "+k.CURRENCY_ABR).appendTo(p);for(var s in n.calculations){if(t[s]&&n.calculations[s].totalPrice&&n.calculations[s].totalPrice>0){if(s==="designPrice"||s==="total"){$("<li>").html(n.calculations[s].name+": "+n.calculations[s].totalPrice+" "+k.CURRENCY_ABR).appendTo(p)}else{$("<li>").html(n.calculations[s].name+": "+n.calculations[s].quantity+" "+n.calculations[s].unit+" * "+n.calculations[s].price+" "+k.CURRENCY_ABR+" = "+n.calculations[s].totalPrice+" "+k.CURRENCY_ABR).appendTo(p)}}}q.appendTo(r)}j.orderControl.priceDescription=$("<div>",{id:"ordercontrol-description"}).fadeOut(0);var c=$("<div>",{id:"ordercontrol-description-head","class":"d-flex justify-content-between align-items-end p-3 bg-light rounded"});var e=$("<div>",{id:"ordercontrol-description-body","class":"collapse","aria-labelledby":"ordercontrol-description-head","data-parent":"#ordercontrol-description"});var g=$("<div>",{"class":"h5 text-primary m-0"}).text("Стоимость: "+l.commonData.calculations.total.totalPrice+" "+k.CURRENCY_ABR).appendTo(c);var f=$("<div>",{"class":"btn btn-link btn-sm ml-3",role:"button","data-toggle":"collapse","data-target":"#ordercontrol-description-body","aria-expanded":"true","aria-controls":"ordercontrol-description-body"}).text("подробнее").appendTo(c);var h=$("<div>",{"class":"p-3"}).appendTo(e);$(e).on("show.bs.collapse",function(){g.fadeTo(100,0.1);f.text("скрыть подробности")});$(e).on("hide.bs.collapse",function(){g.fadeTo(100,1);f.text("подробнее")});$("<h5>").html("Стоимость: "+l.commonData.calculations.total.totalPrice+" "+k.CURRENCY_ABR).appendTo(h);$("<hr>").appendTo(h);for(var a=0;l.items.length>a;a++){b(l.items[a],h)}$("<hr>").appendTo(h);$("<span>",{"class":"text-info h6"}).html("вес ≈ "+l.commonData.calculations.total.kg+" кг.").appendTo(h);if(d&&d==="full"){$("<span>",{"class":"text-info h6"}).html("<br>время изготовления ≈ "+l.commonData.calculations.total.hours+" ч.").appendTo(h);$("<span>",{"class":"text-info h6"}).html("<br>"+Math.ceil(l.commonData.calculations.total.materialCost)+" / "+Math.ceil((l.commonData.calculations.total.materialCost*100/l.commonData.calculations.total.totalPrice))).appendTo(h)}c.appendTo(j.orderControl.priceDescription);e.appendTo(j.orderControl.priceDescription);if(j.orderControl.descriptionBlok){j.orderControl.priceDescription.appendTo(j.orderControl.descriptionBlok).fadeIn(100)}else{return false}}}})();window.printCalcForm=(function(){function a(t,n){n.fadeOut(0);var c={orderItems:[],orderControl:{alertsWrapper:false,customer:false,customerId:false,customerList:false,promoCodes:false,calcButton:false,resetButton:false,blankButton:false,toSaveButton:false}};function u(aC,aH,aj){var C=1000;var au="orderitem-"+aC;var E=false;var aS=false;var J=false;var aV={removeEvtList:false,blok:false,alertsWrapper:false,maxPrintWidth:false,index:false,printSize:[],canvasSize:[],materialGroup:false,materialType:false,printType:false,noTechFields:false,manualMaterialFormat:false,customOptionalWorkToggle:false,simpleOptionalWork:{cringle:false,cringleCustom:false,gain:false,cut:false,cord:false,pocket:false,pocketCustom:false,lamination:false,stickToPlastic:false},designPrice:false,notes:false,customOptionalWork:{top:{cringle:false,cringleCustom:false,gain:false,cut:false,cord:false,pocket:false,pocketCustom:false,lamination:false,stickToPlastic:false},bottom:{cringle:false,cringleCustom:false,gain:false,cut:false,cord:false,pocket:false,pocketCustom:false,lamination:false,stickToPlastic:false},left:{cringle:false,cringleCustom:false,gain:false,cut:false,cord:false,pocket:false,pocketCustom:false,lamination:false,stickToPlastic:false},right:{cringle:false,cringleCustom:false,gain:false,cut:false,cord:false,pocket:false,pocketCustom:false,lamination:false,stickToPlastic:false}},designPriceCustom:false};var ag=$("<fieldset>",{"class":"border border-secondary rounded mb-5",id:au}).fadeOut(0);aV.blok=ag;aV.index=aC;function T(aX){A(aX);an(aX);H(aX)}function K(aX){ap(aX);aJ(aX)}function an(aX){var aY=$(aX.target).data();if(aY.action==="closePrintSize"){if(printCalcLibrary.getFullArrItemsNumber(aV.printSize)>1){U(aX)}M()}}function H(aX){var aY=$(aX.target).data();if(aY.action&&aY.action==="closeCanvasSize"){if(printCalcLibrary.getFullArrItemsNumber(aV.printSize)===1||printCalcLibrary.getFullArrItemsNumber(aV.canvasSize)>1){ak(aX)}M()}}function M(){if(printCalcLibrary.getFullArrItemsNumber(aV.canvasSize)>0){for(var aY=0;aV.printSize.length>aY;aY++){if(aV.printSize[aY]!==false){aV.printSize[aY].fileName.attr("disabled","true")}}for(var aX=0;aV.canvasSize.length>aX;aX++){if(aV.canvasSize[aX]!==false){aV.canvasSize[aX].fileName.removeAttr("disabled")}}}else{for(var aY=0;aV.printSize.length>aY;aY++){if(aV.printSize[aY]!==false){aV.printSize[aY].fileName.removeAttr("disabled")}}}}function U(aX){var aY=$(aX.target).data();aY.blok.trigger("change");aY.blok.fadeOut(0).remove();aV.printSize[aY.sizeItemIndex]=false}function ak(aX){var aY=$(aX.target).data();aY.blok.trigger("change");aY.blok.fadeOut(0).remove();aV.canvasSize[aY.sizeItemIndex]=false}function A(aY){var a0=$(aY.target).data();if(a0.action&&a0.action==="swapSize"){var aZ=a0.width.val();var aX=a0.height.val();a0.width.val(aX);a0.height.val(aZ);a0.height.trigger("change")}}var aF=$("<div>",{"class":"bg-light rounded-top pl-3 text-primary clearfix"}).text(aC+1).appendTo(ag);aV.alertsWrapper=$("<div>").appendTo(ag);var az=$("<i>",{"class":"material-icons material-icons_touchable text-secondary float-right"}).data({action:"closeOrderItemWindow",blok:ag,orderItemIndex:aC,}).html("&#xE14C;").appendTo(aF);if(aC!==0){var at=$("<i>",{"class":"material-icons material-icons_touchable text-secondary float-right"}).html("&#xE150;");at.data({action:"orderItemAutoComplete",orderItemIndex:aC});at.appendTo(aF)}var aU=$("<div>",{"class":"p-3"}).appendTo(ag);$("<h4>",{"class":"text-primary"}).text("Печать ").appendTo(aU);var X=$("<div>").appendTo(aU);$("<h6>").text("Отпечаток").appendTo(X);var aA=$("<i>",{"class":"material-icons material-icons_touchable text-secondary"}).fadeOut(0).html("&#xE145;").appendTo(X);if(aH.userConfig.includeBloks.canvasSize&&aH.userConfig.includeBloks.canvasSize===true){aA.fadeIn(0)}function aD(){if(printCalcLibrary.getFullArrItemsNumber(aV.printSize)<aH.userConfig.includeBloks.maxSizeBlok){var aY=aV.printSize.length;var aX=printCalcLibrary.sizeBlok({inputName:au+"-printsizeitem-"+aY,isertBefore:false,isPrintSize:true});aX.blok.fadeOut(0);aX.close.fadeOut(0);aX.fileNameWrapper.fadeOut(0);if(aH.userConfig.includeBloks.canvasSize&&aH.userConfig.includeBloks.canvasSize===true){aX.close.fadeIn(0);aX.fileNameWrapper.fadeIn(0)}else{aX.quantityWrapper.removeClass("col");aX.quantityWrapper.addClass("col-4")}aX.blok.insertBefore(aA);aX.blok.fadeIn(100);aV.printSize[aY]={width:aX.width,height:aX.height,quantity:aX.quantity,fileName:aX.fileName};aX.close.data({action:"closePrintSize",blok:aX.blok,sizeItemIndex:aY});aX.swap.data({action:"swapSize",width:aX.width,height:aX.height})}}aD();function ad(){if(aH.userConfig.includeBloks.canvasSize&&aH.userConfig.includeBloks.canvasSize===true&&printCalcLibrary.getFullArrItemsNumber(aV.printSize)===1&&printCalcLibrary.getFullArrItemsNumber(aV.canvasSize)===0){aE()}aD();M()}if(aH.userConfig.includeBloks.canvasSize&&aH.userConfig.includeBloks.canvasSize===true){var Z=$("<div>").appendTo(aU);var I=$("<h6>").text("Холст").appendTo(Z);var B=$("<i>",{"class":"material-icons material-icons_touchable text-secondary ml-1"}).html("&#xE150;").appendTo(I);var z=$("<i>",{"class":"material-icons material-icons_touchable text-secondary"}).html("&#xE145;").appendTo(Z)}function aE(){var aY=aV.canvasSize.length;var aX=printCalcLibrary.sizeBlok({inputName:au+"-canvassizeitem-"+aY,isertBefore:false});aX.blok.fadeOut(0);aX.blok.insertBefore(z);aX.blok.fadeIn(100);aV.canvasSize[aY]={width:aX.width,height:aX.height,quantity:aX.quantity,fileName:aX.fileName,blok:aX.blok};aX.close.data({action:"closeCanvasSize",blok:aX.blok,sizeItemIndex:aY});aX.swap.data({action:"swapSize",width:aX.width,height:aX.height})}function W(){if(printCalcLibrary.getFullArrItemsNumber(aV.canvasSize)<aH.userConfig.includeBloks.maxSizeBlok){aE()}M()}function aN(){var aY=0;for(var aZ=0;aV.canvasSize.length>aZ;aZ++){if(aV.canvasSize[aZ]){aV.canvasSize[aZ].blok.remove()}}aV.canvasSize=[];for(var aX=0;aV.printSize.length>aX;aX++){if(aV.printSize[aX]){aE();aV.canvasSize[aY].width.val(aV.printSize[aX].width.val());aV.canvasSize[aY].height.val(aV.printSize[aX].height.val());aV.canvasSize[aY].quantity.val(aV.printSize[aX].quantity.val());aY++}}}function V(){aN()}var av=$("<div>",{"class":"form-row"}).appendTo(aU);var j=printCalcLibrary.typeBlok({title:"Материал",helpIconTitle:false,selectName:au+"-materialgroup",insertIn:av});aV.materialGroup=j.select;function aa(){$("<option>",{value:"none"}).prop({disabled:true,selected:true}).text("выбрать").appendTo(j.select);for(var aX in aH.materialGroups){$("<option>",{value:aX}).text(aH.materialGroups[aX].materialsGroupNameRu).appendTo(j.select)}}aa();function aP(){if(aH.materialGroups[j.select.val()]){E=aH.materialGroups[j.select.val()];ah();aI.select.empty();aK.helpIcon.fadeOut(100);aI.helpIcon.fadeOut(100);L.fadeOut(100).stop(true,true);if(aH.userConfig.includeBloks.manualMaterialFormat&&aH.userConfig.includeBloks.manualMaterialFormat===true){R.select.empty();$("<option>",{value:"default"}).prop({selected:true}).text("авто").appendTo(R.select)}}else{E=false}}var aK=printCalcLibrary.typeBlok({title:"Тип",helpIconTitle:"Выбрать материал",selectName:au+"-materialtype",insertIn:false});aK.helpIcon.fadeOut(0);aV.materialType=aK.select;aK.blok.appendTo(av);function ah(){aK.select.empty();$("<option>",{value:"none"}).prop({disabled:true,selected:true}).text("выбрать").appendTo(aK.select);for(var aX in E.materials){$("<option>",{value:aX}).text(E.materials[aX].materialNameRu).appendTo(aK.select)}}function aW(){if(E.materials[aK.select.val()]){aS=E.materials[aK.select.val()];aQ();aK.helpIcon.attr({"data-original-title":aS.materialInfoTitle,href:aS.materialInfoUrl});aK.helpIcon.fadeIn(100);aI.helpIcon.fadeOut(100);L.fadeOut(100);if(aH.userConfig.includeBloks.noTechFields&&aH.userConfig.includeBloks.noTechFields===true){D.checkbox.prop("checked",false);N()}if(aH.userConfig.includeBloks.manualMaterialFormat&&aH.userConfig.includeBloks.manualMaterialFormat===true){R.select.empty();$("<option>",{value:"default"}).prop({selected:true}).text("авто").appendTo(R.select)}if(aH.userConfig.includeBloks.customOptionalWork&&aH.userConfig.includeBloks.customOptionalWork===true){aM.checkbox.prop("checked",false);am();aO();aR()}ae();Q();if(aH.userConfig.includeBloks.designPrice&&aH.userConfig.includeBloks.designPrice===true){ai.blok.fadeIn(100)}if(aH.userConfig.includeBloks.notes&&aH.userConfig.includeBloks.notes===true){aL.fadeIn(100)}}else{aS=false}}var aI=printCalcLibrary.typeBlok({title:"Тип печати",helpIconTitle:"Выбрать тип печати",selectName:au+"-printtype",insertIn:false});aI.helpIcon.fadeOut(0);aV.printType=aI.select;aI.blok.appendTo(av);function aQ(){aI.select.empty();$("<option>",{value:"none"}).prop({disabled:true,selected:true}).text("выбрать").appendTo(aI.select);for(var aX in aS.materialPrintTypeParametrs){$("<option>",{value:aX}).text(aS.materialPrintTypeParametrs[aX].nameRu).appendTo(aI.select)}}function G(){if(aS.materialPrintTypeParametrs[aI.select.val()]){J=aS.materialPrintTypeParametrs[aI.select.val()];aI.helpIcon.attr({"data-original-title":J.printTypeInfoTitle,href:J.printTypeInfoUrl});aI.helpIcon.fadeIn(100);O();aV.maxPrintWidth=aw();if(aH.userConfig.includeBloks.manualMaterialFormat&&aH.userConfig.includeBloks.manualMaterialFormat===true){aq()}}else{J=false}}var ax=$("<div>",{"class":"mb-4"}).appendTo(aU);$("<span>").text("Доступные форматы").appendTo(ax);var L=$("<span>").appendTo(ax);function O(){L.empty();for(var aX=0;aS.materialFormats.length>aX&&aS.materialFormats[aX]<=J.printerMaxWidth;aX++){printCalcLibrary.badge({badgeTitle:aS.materialFormats[aX]/C,toolTipTitle:"печатное  поле "+((aS.materialFormats[aX]-aS.materialMargin.x*2)/C),insertIn:L})}L.fadeIn(100)}function aw(){if(J){if(aV.manualMaterialFormat===false||aV.manualMaterialFormat.val()==="default"){return(printCalcLibrary.getMaxValue(aS.materialFormats,J.printerMaxWidth)-aS.materialMargin.x*2)/C}else{if(R&&+R.select.val()>0){return(+R.select.val()-aS.materialMargin.x*2)/C}}}}if(aH.userConfig.includeBloks.noTechFields&&aH.userConfig.includeBloks.noTechFields===true){var D=printCalcLibrary.chekboxBlok({title:"Печать без тех полей",helpIconTitle:false,checkboxName:au+"-notechfields",insertIn:false});D.blok.fadeOut(0);aV.noTechFields=D.checkbox;D.blok.appendTo(aU)}function N(){if(aS.materialTechField>0){D.blok.fadeIn(100)}else{D.blok.fadeOut(0)}}if(aH.userConfig.includeBloks.manualMaterialFormat&&aH.userConfig.includeBloks.manualMaterialFormat===true){var R=printCalcLibrary.selectInputBlok({title:"Формат материала",helpIconTitle:false,selectName:au+"-manualmaterialformat",inputName:false,inputTitle:"",insertIn:aU});aV.manualMaterialFormat=R.select;$("<option>",{value:"default"}).prop({selected:true}).text("авто").appendTo(R.select)}function aq(){R.select.empty();$("<option>",{value:"default"}).prop({selected:true}).text("авто").appendTo(R.select);for(var aX=0;aS.materialFormats.length>aX&&aS.materialFormats[aX]<=J.printerMaxWidth;aX++){$("<option>",{value:aS.materialFormats[aX]}).text(aS.materialFormats[aX]/C).appendTo(R.select)}}function Y(){aV.maxPrintWidth=aw()}var ar=$("<div>",{"class":"p-3"}).appendTo(ag);var S=$("<h4>",{"class":"text-primary py-3 mb-0 border-top border-secondary"}).text("Постпечатная обработка").appendTo(ar);if(aH.userConfig.includeBloks.customOptionalWork&&aH.userConfig.includeBloks.customOptionalWork===true){var aM=printCalcLibrary.chekboxBlok({title:"Постпечатная обработка каждой стороны с индивидуальными параметрами",helpIconTitle:false,checkboxName:au+"-customoptionalworktoggle",insertIn:false});aM.blok.fadeOut(0);aV.customOptionalWorkToggle=aM.checkbox;aM.blok.appendTo(ar);aM.blok.addClass("mb-5 mt-0")}function am(){if(aS.materialCustomOptionalWork&&aS.materialCustomOptionalWork===true){aM.blok.fadeIn(100)}else{aM.blok.fadeOut(0)}}function ab(){ae();aO()}function aT(aZ){if(aZ.blokName){aZ.blokName="-"+aZ.blokName}var a4=$("<div>");if(aH.optionalWorks.cringle){var a0=printCalcLibrary.selectInputBlok({title:"Люверсы",helpIconTitle:aH.optionalWorks.cringle.optionalWorkInfoTitle,helpIconUrl:aH.optionalWorks.cringle.optionalWorkInfoUrl,selectName:au+"-cringle"+aZ.blokName,inputName:au+"-cringle"+aZ.blokName+"-custom",inputTitle:"шаг см",insertIn:a4});a0.blok.fadeOut(0);a0.inputWrapper.fadeOut(0);for(var a3=0;a3<aH.optionalWorks.cringle.defaultOptions.length;a3++){if(!aZ.blokName||aH.optionalWorks.cringle.defaultOptions[a3].value!=="corners"){$("<option>",{value:aH.optionalWorks.cringle.defaultOptions[a3].value}).text(aH.optionalWorks.cringle.defaultOptions[a3].title).appendTo(a0.select)}}a0.select.data({action:"showHideCustomInput",blok:a0.inputWrapper})}if(aH.optionalWorks.gain){var a8=printCalcLibrary.chekboxBlok({title:"Усиление края",helpIconTitle:aH.optionalWorks.gain.optionalWorkInfoTitle,helpIconUrl:aH.optionalWorks.gain.optionalWorkInfoUrl,checkboxName:au+"-gain"+aZ.blokName,insertIn:a4});a8.blok.fadeOut(0)}if(aH.optionalWorks.cut){var a6=printCalcLibrary.chekboxBlok({title:"Рез по контуру",helpIconTitle:aH.optionalWorks.cut.optionalWorkInfoTitle,helpIconUrl:aH.optionalWorks.cut.optionalWorkInfoUrl,checkboxName:au+"-cut"+aZ.blokName,insertIn:a4});a6.blok.fadeOut(0)}if(aH.optionalWorks.cord){var a1=printCalcLibrary.chekboxBlok({title:"Шнур",helpIconTitle:aH.optionalWorks.cord.optionalWorkInfoTitle,helpIconUrl:aH.optionalWorks.cord.optionalWorkInfoUrl,checkboxName:au+"-cord"+aZ.blokName,insertIn:a4});a1.blok.fadeOut(0)}if(aH.optionalWorks.pocket){var a9=printCalcLibrary.selectInputBlok({title:"Карман",helpIconTitle:aH.optionalWorks.pocket.optionalWorkInfoTitle,helpIconUrl:aH.optionalWorks.pocket.optionalWorkInfoUrl,selectName:au+"-pocket"+aZ.blokName,inputName:au+"-pocket"+aZ.blokName+"-custom",inputTitle:"размер см",insertIn:a4});a9.blok.fadeOut(0);a9.inputWrapper.fadeOut(0);for(var a2=0;a2<aH.optionalWorks.pocket.defaultOptions.length;a2++){$("<option>",{value:aH.optionalWorks.pocket.defaultOptions[a2].value}).text(aH.optionalWorks.pocket.defaultOptions[a2].title).appendTo(a9.select)}a9.select.data({action:"showHideCustomInput",blok:a9.inputWrapper})}if(aH.optionalWorks.lamination){var aY=printCalcLibrary.selectInputBlok({title:"Ламинация",helpIconTitle:"Текст подсказки",selectName:au+"-lamination"+aZ.blokName,inputName:false,inputTitle:false,insertIn:a4});aY.helpIcon.fadeOut(0);aY.blok.fadeOut(0);$("<option>",{value:"none"}).text("нет").appendTo(aY.select);for(var a7 in aH.optionalWorks.lamination.materials){$("<option>",{value:a7}).text(aH.optionalWorks.lamination.materials[a7].nameRu).appendTo(aY.select)}aY.select.data({action:"fillLaminationHelpIcon",helpIcon:aY.helpIcon})}if(aH.optionalWorks.stickToPlastic){var aX=printCalcLibrary.selectInputBlok({title:"Накатка",helpIconTitle:"Текст подсказки",selectName:au+"-sticktoplastic"+aZ.blokName,inputName:false,inputTitle:false,insertIn:a4});aX.helpIcon.fadeOut(0);aX.blok.fadeOut(0);$("<option>",{value:"none"}).text("нет").appendTo(aX.select);for(var a5 in aH.optionalWorks.stickToPlastic.materials){$("<option>",{value:a5}).text(aH.optionalWorks.stickToPlastic.materials[a5].nameRu).appendTo(aX.select)}aX.select.data({action:"fillStickToPlasticHelpIcon",helpIcon:aX.helpIcon})}if(aZ.insertIn){a4.appendTo(aZ.insertIn)}return{blok:a4,cringle:a0,gain:a8,cut:a6,cord:a1,pocket:a9,lamination:aY,stickToPlastic:aX}}function aJ(aX){var aY=$(aX.target);var aZ=aY.data();if(aZ.action&&aZ.action==="fillLaminationHelpIcon"){if(aH.optionalWorks.lamination.materials[aY.val()]&&aH.optionalWorks.lamination.materials[aY.val()].optionalWorkInfoTitle){aZ.helpIcon.attr({"data-original-title":aH.optionalWorks.lamination.materials[aY.val()].optionalWorkInfoTitle,href:aH.optionalWorks.lamination.materials[aY.val()].optionalWorkInfoUrl});aZ.helpIcon.fadeIn(100)}else{aZ.helpIcon.fadeOut(100)}}}function ap(aX){var aY=$(aX.target);var aZ=aY.data();if(aZ.action&&aZ.action==="fillStickToPlasticHelpIcon"){if(aH.optionalWorks.stickToPlastic.materials[aY.val()]&&aH.optionalWorks.stickToPlastic.materials[aY.val()].optionalWorkInfoTitle){aZ.helpIcon.attr({"data-original-title":aH.optionalWorks.stickToPlastic.materials[aY.val()].optionalWorkInfoTitle,href:aH.optionalWorks.stickToPlastic.materials[aY.val()].optionalWorkInfoUrl});aZ.helpIcon.fadeIn(100)}else{aZ.helpIcon.fadeOut(100)}}}var P=aT({blokName:"",insertIn:false});P.blok.fadeOut(0).appendTo(ar);aV.simpleOptionalWork.cringle=P.cringle.select;aV.simpleOptionalWork.cringleCustom=P.cringle.input;aV.simpleOptionalWork.gain=P.gain.checkbox;aV.simpleOptionalWork.cut=P.cut.checkbox;aV.simpleOptionalWork.cord=P.cord.checkbox;aV.simpleOptionalWork.pocket=P.pocket.select;aV.simpleOptionalWork.pocketCustom=P.pocket.input;aV.simpleOptionalWork.lamination=P.lamination.select;aV.simpleOptionalWork.stickToPlastic=P.stickToPlastic.select;function ae(){if(aH.userConfig.includeBloks.customOptionalWork&&aH.userConfig.includeBloks.customOptionalWork===true&&aM.checkbox.prop("checked")){P.blok.fadeOut(0)}else{P.blok.fadeIn(100)}}function Q(){if(aS.materialCringle&&aS.materialCringle===true){P.cringle.blok.fadeIn(100)}else{P.cringle.blok.fadeOut(0)}if(aS.materialGain&&aS.materialGain===true){P.gain.blok.fadeIn(100)}else{P.gain.blok.fadeOut(0)}if(aS.materialCut&&aS.materialCut===true){P.cut.blok.fadeIn(100)}else{P.cut.blok.fadeOut(0)}if(aS.materialCord&&aS.materialCord===true){P.cord.blok.fadeIn(100)}else{P.cord.blok.fadeOut(0)}if(aS.materialPocket&&aS.materialPocket===true){P.pocket.blok.fadeIn(100)}else{P.pocket.blok.fadeOut(0)}if(aS.materialLamination&&aS.materialLamination===true){P.lamination.blok.fadeIn(100)}else{P.lamination.blok.fadeOut(0)}if(aS.materialStickToPlastic&&aS.materialStickToPlastic===true){P.stickToPlastic.blok.fadeIn(100)}else{P.stickToPlastic.blok.fadeOut(0)}}if(aH.userConfig.includeBloks.customOptionalWork&&aH.userConfig.includeBloks.customOptionalWork===true){var ay=$("<div>").fadeOut(0).appendTo(ar);var ao=aT({blokName:"top",insertIn:false});aV.customOptionalWork.top.cringle=ao.cringle.select;aV.customOptionalWork.top.cringleCustom=ao.cringle.input;aV.customOptionalWork.top.gain=ao.gain.checkbox;aV.customOptionalWork.top.cut=ao.cut.checkbox;aV.customOptionalWork.top.cord=ao.cord.checkbox;aV.customOptionalWork.top.pocket=ao.pocket.select;aV.customOptionalWork.top.pocketCustom=ao.pocket.input;aV.customOptionalWork.top.lamination=ao.lamination.select;aV.customOptionalWork.top.stickToPlastic=ao.stickToPlastic.select;var af=aT({blokName:"bottom",insertIn:false});aV.customOptionalWork.bottom.cringle=af.cringle.select;aV.customOptionalWork.bottom.cringleCustom=af.cringle.input;aV.customOptionalWork.bottom.gain=af.gain.checkbox;aV.customOptionalWork.bottom.cut=af.cut.checkbox;aV.customOptionalWork.bottom.cord=af.cord.checkbox;aV.customOptionalWork.bottom.pocket=af.pocket.select;aV.customOptionalWork.bottom.pocketCustom=af.pocket.input;aV.customOptionalWork.bottom.lamination=af.lamination.select;aV.customOptionalWork.bottom.stickToPlastic=af.stickToPlastic.select;var aG=aT({blokName:"left",insertIn:false});aV.customOptionalWork.left.cringle=aG.cringle.select;aV.customOptionalWork.left.cringleCustom=aG.cringle.input;aV.customOptionalWork.left.gain=aG.gain.checkbox;aV.customOptionalWork.left.cut=aG.cut.checkbox;aV.customOptionalWork.left.cord=aG.cord.checkbox;aV.customOptionalWork.left.pocket=aG.pocket.select;aV.customOptionalWork.left.pocketCustom=aG.pocket.input;aV.customOptionalWork.left.lamination=aG.lamination.select;aV.customOptionalWork.left.stickToPlastic=aG.stickToPlastic.select;var aB=aT({blokName:"right",insertIn:false});aV.customOptionalWork.right.cringle=aB.cringle.select;aV.customOptionalWork.right.cringleCustom=aB.cringle.input;aV.customOptionalWork.right.gain=aB.gain.checkbox;aV.customOptionalWork.right.cut=aB.cut.checkbox;aV.customOptionalWork.right.cord=aB.cord.checkbox;aV.customOptionalWork.right.pocket=aB.pocket.select;aV.customOptionalWork.right.pocketCustom=aB.pocket.input;aV.customOptionalWork.right.lamination=aB.lamination.select;aV.customOptionalWork.right.stickToPlastic=aB.stickToPlastic.select;printCalcLibrary.tabs({blokName:au+"-optionalwork",insertIn:ay,tabs:[{isActive:true,tabTitle:"Верх",tabContent:ao.blok},{isActive:false,tabTitle:"Низ",tabContent:af.blok},{isActive:false,tabTitle:"Лево",tabContent:aG.blok},{isActive:false,tabTitle:"Право",tabContent:aB.blok}]})}function aO(){if(aS.materialCustomOptionalWork&&aM.checkbox.prop("checked")){ay.fadeIn(100)}else{ay.fadeOut(0)}}function aR(){if(aS.materialCringle&&aS.materialCringle===true){ao.cringle.blok.fadeIn(100);af.cringle.blok.fadeIn(100);aG.cringle.blok.fadeIn(100);aB.cringle.blok.fadeIn(100)}else{ao.cringle.blok.fadeOut(0);af.cringle.blok.fadeOut(0);aG.cringle.blok.fadeOut(0);aB.cringle.blok.fadeOut(0)}if(aS.materialGain&&aS.materialGain===true){ao.gain.blok.fadeIn(100);af.gain.blok.fadeIn(100);aG.gain.blok.fadeIn(100);aB.gain.blok.fadeIn(100)}else{ao.gain.blok.fadeOut(0);af.gain.blok.fadeOut(0);aG.gain.blok.fadeOut(0);aB.gain.blok.fadeOut(0)}if(aS.materialCut&&aS.materialCut===true){ao.cut.blok.fadeIn(100);af.cut.blok.fadeIn(100);aG.cut.blok.fadeIn(100);aB.cut.blok.fadeIn(100)}else{ao.cut.blok.fadeOut(0);af.cut.blok.fadeOut(0);aG.cut.blok.fadeOut(0);aB.cut.blok.fadeOut(0)}if(aS.materialCord&&aS.materialCord===true){ao.cord.blok.fadeIn(100);af.cord.blok.fadeIn(100);aG.cord.blok.fadeIn(100);aB.cord.blok.fadeIn(100)}else{ao.cord.blok.fadeOut(0);af.cord.blok.fadeOut(0);aG.cord.blok.fadeOut(0);aB.cord.blok.fadeOut(0)}if(aS.materialPocket&&aS.materialPocket===true){ao.pocket.blok.fadeIn(100);af.pocket.blok.fadeIn(100);aG.pocket.blok.fadeIn(100);aB.pocket.blok.fadeIn(100)}else{ao.pocket.blok.fadeOut(0);af.pocket.blok.fadeOut(0);aG.pocket.blok.fadeOut(0);aB.pocket.blok.fadeOut(0)}if(aS.materialLamination&&aS.materialLamination===true){ao.lamination.blok.fadeIn(100);af.lamination.blok.fadeIn(100);aG.lamination.blok.fadeIn(100);aB.lamination.blok.fadeIn(100)}else{ao.lamination.blok.fadeOut(0);af.lamination.blok.fadeOut(0);aG.lamination.blok.fadeOut(0);aB.lamination.blok.fadeOut(0)}if(aS.materialStickToPlastic&&aS.materialStickToPlastic===true){ao.stickToPlastic.blok.fadeIn(100);af.stickToPlastic.blok.fadeIn(100);aG.stickToPlastic.blok.fadeIn(100);aB.stickToPlastic.blok.fadeIn(100)}else{ao.stickToPlastic.blok.fadeOut(0);af.stickToPlastic.blok.fadeOut(0);aG.stickToPlastic.blok.fadeOut(0);aB.stickToPlastic.blok.fadeOut(0)}}if(aH.userConfig.includeBloks.designPrice){var F=$("<div>",{"class":"p-3"}).appendTo(ag);var al=$("<h4>",{"class":"text-primary py-3 border-top border-secondary"}).text("Дополнительно").appendTo(F)}if(aH.otherParam.designPrice&&aH.userConfig.includeBloks.designPrice&&aH.userConfig.includeBloks.designPrice===true){var ai=printCalcLibrary.selectInputBlok({title:"Стоимость макета",helpIconTitle:false,selectName:au+"-designprice",inputName:au+"-designprice-custom",inputTitle:"Руб",insertIn:F});ai.blok.fadeOut(0);ai.inputWrapper.fadeOut(0);aV.designPrice=ai.select;aV.designPriceCustom=ai.input;for(var ac=0;ac<aH.otherParam.designPrice.defaultOptions.length;ac++){$("<option>",{value:aH.otherParam.designPrice.defaultOptions[ac].value}).text(aH.otherParam.designPrice.defaultOptions[ac].title).appendTo(ai.select)}ai.select.data({action:"showHideCustomInput",blok:ai.inputWrapper})}if(aH.userConfig.includeBloks.notes&&aH.userConfig.includeBloks.notes===true){var aL=$("<div>",{"class":""}).appendTo(F);aL.fadeOut(0);aV.notes=$("<input>",{"class":"form-control form-control-sm",id:au+"-notes",type:"text",maxlength:"150",rows:"1",placeholder:"заметки"}).appendTo(aL)}ag.on("click",T);ag.on("change",K);j.select.on("change",aP);aK.select.on("change",aW);aI.select.on("change",G);if(R){R.select.on("change",Y)}if(aH.userConfig.includeBloks.canvasSize&&aH.userConfig.includeBloks.canvasSize===true){aA.on("click",ad);z.on("click",W);B.on("click",V)}if(aH.userConfig.includeBloks.customOptionalWork&&aH.userConfig.includeBloks.customOptionalWork===true){aM.checkbox.on("change",ab)}aV.removeEvtList=function(){ag.off("click",T);ag.off("change",K);j.select.off("change",aP);aK.select.off("change",aW);aI.select.off("change",G);if(R){R.select.off("change",Y)}if(aH.userConfig.includeBloks.canvasSize&&aH.userConfig.includeBloks.canvasSize===true){aA.off("click",ad);z.off("click",W);B.off("click",V)}if(aH.userConfig.includeBloks.customOptionalWork&&aH.userConfig.includeBloks.customOptionalWork===true){aM.checkbox.off("change",ab)}};aj.before(ag.fadeIn(100));return aV}var o=$("<i>",{"class":"material-icons material-icons_touchable text-secondary mb-5",style:"font-size:5rem"}).html("&#xE145;").appendTo(n);var m=$("<fieldset>",{"class":"border border-secondary rounded"});c.orderControl.alertsWrapper=$("<div>").appendTo(m);var h=$("<div>",{"class":"p-3"}).appendTo(m);if(t.userConfig.includeBloks.customer||t.userConfig.includeBloks.customer===true){var l=$("<div>",{"class":"input-group form-group mb-0"}).appendTo(h);var y=$("<input>",{type:"text","class":"form-control form-control-sm",placeholder:"клиент поиск по имени почте или телефону",id:"ordercontrol-customer",name:"ordercontrol-customer",list:"customer-list"}).appendTo(l);var q=$("<a>",{href:t.userConfig.includeBloks.addCustomerButton,target:"_blank","class":"btn btn-outline-primary btn-sm",role:"button"}).html("добавить").appendTo($("<div>",{"class":"input-group-append"}).appendTo(l));c.orderControl.customerList=$("<div>",{"class":"mb-3"}).appendTo(h);c.orderControl.customer=y}if(t.userConfig.includeBloks.promoCodes&&t.userConfig.includeBloks.promoCodes===true){var w=$("<div>",{"class":"form-group"}).appendTo(h);var d=$("<input>",{type:"text","class":"form-control form-control-sm",placeholder:"промо код",id:"ordercontrol-promocode",name:"ordercontrol-promocode"}).appendTo(w);if(t.userConfig.includeBloks.quickPromoCodes.length&&t.userConfig.includeBloks.quickPromoCodes.length>0){for(var v=0;t.userConfig.includeBloks.quickPromoCodes.length>v;v++){$("<span>",{"class":"btn btn-sm btn-link",role:"button"}).text(t.userConfig.includeBloks.quickPromoCodes[v]).data({action:"quickFillPromoCode",value:t.userConfig.includeBloks.quickPromoCodes[v],input:d}).appendTo(w)}}c.orderControl.promoCodes=d}var x=$("<div>").appendTo(h);c.orderControl.calcButton=$("<button>",{type:"button","class":"btn btn-sm btn-primary mr-1"}).html("расчитать").appendTo(x);if(t.userConfig.includeBloks.toSaveButton&&t.userConfig.includeBloks.toSaveButton===true){c.orderControl.toSaveButton=$("<button>",{type:"button","class":"btn btn-sm btn-primary mr-1"}).text("сохранить").appendTo(x)}if(t.userConfig.includeBloks.blankButton&&t.userConfig.includeBloks.blankButton===true){c.orderControl.blankButton=$("<button>",{type:"button","class":"btn btn-sm btn-primary mr-1"}).html("бланк").appendTo(x)}c.orderControl.resetButton=$("<button>",{type:"button","class":"btn btn-sm btn-danger mr-1"}).html("сбросить").appendTo(x);c.orderControl.descriptionBlok=$("<div>").appendTo(m);if(t.userConfig.includeBloks.promoSite&&typeof t.userConfig.includeBloks.promoSite==="string"){$("<a>",{href:t.userConfig.includeBloks.promoSite,target:"_blank","class":"badge badge-info"}).text("Хочу такую же форму себе на сайт").appendTo($("<div>",{"class":"mt-1 d-flex justify-content-end"}).appendTo(h))}function b(j){if(printCalcLibrary.getFullArrItemsNumber(c.orderItems)>1){var z=$(j.target).data();if(z.action&&z.action==="closeOrderItemWindow"){$(j.target).trigger("change");c.orderItems[z.orderItemIndex].removeEvtList();c.orderItems[z.orderItemIndex]=false;z.blok.fadeOut(0).remove()}}}function e(){if(printCalcLibrary.getFullArrItemsNumber(c.orderItems)<t.userConfig.includeBloks.maxOrderBlok){var j=c.orderItems.length;c.orderItems[j]=u(j,t,o)}}e();function f(j){var z=$(j.target).data();if(z.action&&z.action==="quickFillPromoCode"){z.input.val(z.input.val()+z.value+", ");z.input.trigger("change")}}function s(j){var z=$(j.target).data();if(z.action&&z.action==="inputCustomer"){z.orderControl.customer.val(z.name);z.orderControl.customerId=z.id;z.orderControl.customer.trigger("change")}}function r(j){var z=$(j.target).data();if(z.action&&z.action==="showHideCustomInput"){if($(j.target).val()==="custom"){z.blok.fadeIn(100)}else{z.blok.fadeOut(100)}}}function p(j){var B=$(j.target).data();if(B.action&&B.action==="orderItemAutoComplete"){var A=printCalcLibrary.getFirstLastFillArrIndex(B.orderItemIndex,c.orderItems);var C=B.orderItemIndex;if(typeof(A)==="number"&&typeof(C)==="number"&&c.orderItems[A]&&c.orderItems[C]){function z(E,D){if(E.cringle&&E.cringle.val()){D.cringle.val(E.cringle.val());D.cringleCustom.val(E.cringleCustom.val());D.cringle.trigger("change")}D.gain.prop("checked",E.gain.prop("checked"));D.cut.prop("checked",E.cut.prop("checked"));D.cord.prop("checked",E.cord.prop("checked"));if(E.pocket&&E.pocket.val()){D.pocket.val(E.pocket.val());D.pocketCustom.val(E.pocketCustom.val());D.pocket.trigger("change")}if(E.lamination&&E.lamination.val()){D.lamination.val(E.lamination.val());D.lamination.trigger("change")}if(E.stickToPlastic&&E.stickToPlastic.val()){D.stickToPlastic.val(E.stickToPlastic.val());D.stickToPlastic.trigger("change")}}if(c.orderItems[A].materialGroup&&c.orderItems[A].materialGroup.val()){c.orderItems[C].materialGroup.val(c.orderItems[A].materialGroup.val());c.orderItems[C].materialGroup.trigger("change")}if(c.orderItems[A].materialType&&c.orderItems[A].materialType.val()){c.orderItems[C].materialType.val(c.orderItems[A].materialType.val());c.orderItems[C].materialType.trigger("change")}if(c.orderItems[A].printType&&c.orderItems[A].printType.val()){c.orderItems[C].printType.val(c.orderItems[A].printType.val());c.orderItems[C].printType.trigger("change")}if(c.orderItems[A].noTechFields){c.orderItems[C].noTechFields.prop("checked",c.orderItems[A].noTechFields.prop("checked"))}if(c.orderItems[A].manualMaterialFormat){c.orderItems[C].manualMaterialFormat.val(c.orderItems[A].manualMaterialFormat.val());c.orderItems[C].manualMaterialFormat.trigger("change")}z(c.orderItems[A].simpleOptionalWork,c.orderItems[C].simpleOptionalWork);if(c.orderItems[A].customOptionalWorkToggle){c.orderItems[C].customOptionalWorkToggle.prop("checked",c.orderItems[A].customOptionalWorkToggle.prop("checked"));c.orderItems[C].customOptionalWorkToggle.trigger("change");z(c.orderItems[A].customOptionalWork.top,c.orderItems[C].customOptionalWork.top);z(c.orderItems[A].customOptionalWork.bottom,c.orderItems[C].customOptionalWork.bottom);z(c.orderItems[A].customOptionalWork.left,c.orderItems[C].customOptionalWork.left);z(c.orderItems[A].customOptionalWork.right,c.orderItems[C].customOptionalWork.right)}if(c.orderItems[A].designPrice){c.orderItems[C].designPrice.val(c.orderItems[A].designPrice.val());c.orderItems[C].designPriceCustom.val(c.orderItems[A].designPriceCustom.val());c.orderItems[C].designPrice.trigger("change")}}}}function k(j){r(j)}function g(j){e();$(j.target).trigger("change")}function i(j){b(j);p(j);f(j);s(j)}o.on("click",g);n.on("click",i);n.on("change",k);m.appendTo(n);n.fadeIn(100);return c}return{newForm:a,}})();window.printCalcMain=(function(){var t={conteinerName:"print-calc-container",CURRENCY_ABR:"р.",CONVERT_MM_TO_SIZE_UNIT:1000};var o=false;var l=false;var j=false;var k=false;var d=[];var r=true;var h=true;var b=$("."+t.conteinerName);var e=b.attr("data-url");if(e){$.ajax({url:e,type:"GET",dataType:"json",data:{action:"get-print-data"},success:function(u){i(u)}})}function q(){r=true;h=true;o.orderControl.calcButton.removeAttr("disabled");if(o.orderControl.blankButton){o.orderControl.blankButton.removeAttr("disabled","")}j.fadeOut(100)}function g(){r=true;h=true;o.orderControl.calcButton.removeAttr("disabled");if(o.orderControl.blankButton){o.orderControl.blankButton.removeAttr("disabled","")}j.fadeOut(100)}function i(u){o=window.printCalcForm.newForm(u,b);o.orderControl.calcButton.on("click",p);if(o.orderControl.customer){o.orderControl.customer.on("input",c)}if(o.orderControl.blankButton){o.orderControl.blankButton.on("click",m)}if(o.orderControl.toSaveButton){o.orderControl.toSaveButton.on("click",s)}o.orderControl.resetButton.on("click",n);b.on("change",q);b.on("input",g);j=o.orderControl.descriptionBlok;k=u.userConfig.includeBloks.descriptionBlokDetails}function p(){if(printCalcLibrary.checkForm(o)&&r){$.ajax({url:e,type:"POST",dataType:"json",data:{action:"get-calc-result-data","print-calc-form-value":JSON.stringify(printCalcLibrary.getPrintCalcFormValue(o))},success:function(u){a(u)}})}}function a(u){l=u;printCalcLibrary.createPriceDescriptionBlok(l,o,t,k);r=false;o.orderControl.calcButton.attr("disabled","");j.fadeIn(100)}function s(){if(printCalcLibrary.checkForm(o)&&printCalcLibrary.checkCorrectCustomer(o,d)){$.ajax({url:e,type:"POST",dataType:"json",data:{action:"save-print-order","print-calc-form-value":JSON.stringify(printCalcLibrary.getPrintCalcFormValue(o))},success:function(u){if(u["operation-status"]&&u["operation-status"]==="true"){window.open(u.url);location.reload()}else{if(u["error-massage"]){printCalcLibrary.shsowOrderControlErrorMassage(o,u["error-massage"])}else{printCalcLibrary.shsowOrderControlErrorMassage(o,"неизвестная ошибка")}}}})}}function m(){if(printCalcLibrary.checkForm(o)===true&&h){$.ajax({url:e,type:"POST",dataType:"json",data:{action:"save-tmp-calc-result-data","print-calc-form-value":JSON.stringify(printCalcLibrary.getPrintCalcFormValue(o))},success:function(u){if(u["operation-status"]&&u["operation-status"]==="true"){h=false;o.orderControl.blankButton.attr("disabled","");window.open(u.url)}else{if(u["error-massage"]){printCalcLibrary.shsowOrderControlErrorMassage(o,u["error-massage"])}else{printCalcLibrary.shsowOrderControlErrorMassage(o,"неизвестная ошибка")}}}})}}function f(){if(o.orderControl.customer&&o.orderControl.customer.val().length>=3){$.ajax({url:e,type:"GET",dataType:"json",data:{action:"get-client-names","short-info":o.orderControl.customer.val()},success:function(v){if(v.length!==o.orderControl.customerList.data("lastCustomerDataLength")){d=v;o.orderControl.customerList.fadeTo(100,0);o.orderControl.customerList.empty();for(var u=0;u<v.length;u++){$("<span>",{"class":"btn btn-sm btn-link",role:"button"}).text(v[u]["name"].toLowerCase()).appendTo(o.orderControl.customerList).data({action:"inputCustomer",name:v[u]["name"],id:v[u]["id"],orderControl:o.orderControl})}o.orderControl.customerList.fadeTo(100,1);o.orderControl.customerList.data({lastCustomerDataLength:v.length})}}})}else{if(o.orderControl.customer.val().length<3){o.orderControl.customerList.fadeTo(100,0);o.orderControl.customerList.empty();o.orderControl.customerList.data({lastCustomerDataLength:0})}}}function c(){f()}function n(){location.reload()}return false})();